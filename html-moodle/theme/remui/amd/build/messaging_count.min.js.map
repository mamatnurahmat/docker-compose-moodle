{"version":3,"file":"messaging_count.min.js","sources":["../src/messaging_count.js"],"sourcesContent":["/* eslint-disable no-console*/\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     theme_remui/messaging_count\n * @copyright (c) 2023 WisdmLabs (https://wisdmlabs.com/)\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(\n    ['jquery',\n        'core/ajax',\n        'core/notification',\n        'core/pubsub',\n        'core_message/message_drawer_router',\n        'core_message/message_drawer_routes',\n        'core_message/message_drawer_events',\n    ],\n    function (\n        $,\n        Ajax,\n        Notification,\n        PubSub,\n        Router,\n        Routes,\n        MessageDrawerEvents,\n    ) {\n\n        const getUserCount = function () {\n            Ajax.call([{\n                methodname: 'theme_remui_get_msg_contact_list_count',\n                args: {\n                    userid: 1\n                },\n                done: function (data) {\n                    data = $.parseJSON(data);\n                    $('.show-contacts-section span').remove();\n                    $('.show-contacts-section').append(data.showmsgcount);\n                    $('[data-action=\"show-requests-section\"] span').remove();\n                    $('[data-action=\"show-requests-section\"]').append(data.showrequestcount);\n                    console.log((data.showmsgcount));\n                    console.log(data.showrequestcount);\n                },\n                fail: function () {\n                    console.log(Notification.exception);\n                }\n            }]);\n        };\n        const getLogInUserdetails = function () {\n            Ajax.call([{\n                methodname: 'theme_remui_get_login_user_detail',\n                args: {},\n                done: function (data) {\n                    $(\".send .messager-info .messager-img-container\").remove();\n                    $(\".send .messager-info .username\").remove();\n                    $(\".send .messager-info\").append(data);\n                },\n                fail: function () {\n                    console.log(Notification.exception);\n                }\n            }]);\n        };\n\n        const init = function () {\n            $(document).ready(function () {\n                getUserCount();\n                PubSub.subscribe(MessageDrawerEvents.CONVERSATION_READ, function () {\n                    getLogInUserdetails();\n                });\n\n                // This events are used to handle the contact counts on contacts page.\n                PubSub.subscribe(MessageDrawerEvents.CONTACT_ADDED, function () {\n                    getUserCount();\n                });\n                PubSub.subscribe(MessageDrawerEvents.CONTACT_REMOVED, function () {\n                    getUserCount();\n                });\n                PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_ACCEPTED, getUserCount());\n\n                PubSub.subscribe(MessageDrawerEvents.CONTACT_REQUEST_DECLINED, getUserCount());\n\n                $(\"[data-action='decline-contact-request']\").on('click', function () {\n                    setTimeout(getUserCount, 100);\n                });\n\n            });\n        };\n        return {\n            init: init\n        };\n    });\n"],"names":["define","$","Ajax","Notification","PubSub","Router","Routes","MessageDrawerEvents","getUserCount","call","methodname","args","userid","done","data","parseJSON","remove","append","showmsgcount","showrequestcount","console","log","fail","exception","init","document","ready","subscribe","CONVERSATION_READ","CONTACT_ADDED","CONTACT_REMOVED","CONTACT_REQUEST_ACCEPTED","CONTACT_REQUEST_DECLINED","on","setTimeout"],"mappings":";;;;;AAsBAA,qCACI,CAAC,SACG,YACA,oBACA,cACA,qCACA,qCACA,uCAEJ,SACIC,EACAC,KACAC,aACAC,OACAC,OACAC,OACAC,2BAGMC,aAAe,WACjBN,KAAKO,KAAK,CAAC,CACPC,WAAY,yCACZC,KAAM,CACFC,OAAQ,GAEZC,KAAM,SAAUC,MACZA,KAAOb,EAAEc,UAAUD,MACnBb,EAAE,+BAA+Be,SACjCf,EAAE,0BAA0BgB,OAAOH,KAAKI,cACxCjB,EAAE,8CAA8Ce,SAChDf,EAAE,yCAAyCgB,OAAOH,KAAKK,kBACvDC,QAAQC,IAAKP,KAAKI,cAClBE,QAAQC,IAAIP,KAAKK,mBAErBG,KAAM,WACFF,QAAQC,IAAIlB,aAAaoB,sBA2C9B,CACHC,KAzBS,WACTvB,EAAEwB,UAAUC,OAAM,WACdlB,eACAJ,OAAOuB,UAAUpB,oBAAoBqB,mBAAmB,WAjB5D1B,KAAKO,KAAK,CAAC,CACPC,WAAY,oCACZC,KAAM,GACNE,KAAM,SAAUC,MACZb,EAAE,gDAAgDe,SAClDf,EAAE,kCAAkCe,SACpCf,EAAE,wBAAwBgB,OAAOH,OAErCQ,KAAM,WACFF,QAAQC,IAAIlB,aAAaoB,kBAa7BnB,OAAOuB,UAAUpB,oBAAoBsB,eAAe,WAChDrB,kBAEJJ,OAAOuB,UAAUpB,oBAAoBuB,iBAAiB,WAClDtB,kBAEJJ,OAAOuB,UAAUpB,oBAAoBwB,yBAA0BvB,gBAE/DJ,OAAOuB,UAAUpB,oBAAoByB,yBAA0BxB,gBAE/DP,EAAE,2CAA2CgC,GAAG,SAAS,WACrDC,WAAW1B,aAAc"}