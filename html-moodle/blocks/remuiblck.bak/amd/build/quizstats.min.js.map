{"version":3,"sources":["quizstats.js"],"names":["define","$","Ajax","SELECTORS","CHART","CHART_AREA","COURSE_LIST","COURSE_LIST_SELECTED","ERROR","barChart","getStepSize","datasets","current","max","forEach","data","index","Math","apply","ceil","createBarChart","root","course_id","find","call","methodname","args","courseid","done","response","undefined","hide","show","destroy","barcontext","get","getContext","canvas","height","barData","labels","Chart","type","options","responsive","maintainAspectRatio","scales","yAxes","scaleLabel","display","labelString","M","util","get_string","ticks","min","stepSize","fail","ex","init","document","ready","on","initEvents","length"],"mappings":"AAAAA,OAAO,CAAC,SAAU,YAAa,gBAAiB,SAASC,EAAGC,GAExD,IAAIC,EAAY,CACZC,MAAO,YACPC,WAAY,mBACZC,YAAa,oBACbC,qBAAsB,kBACtBC,MAAO,qBAEPC,EAAW,KAEXC,EAAc,SAASC,GACvB,IACIC,EADAC,EAAM,EAMV,OAJAF,EAASG,QAAQ,SAASC,EAAMC,GAC5BJ,EAAUK,KAAKJ,IAAIK,MAAMD,KAAMF,EAAKA,MACpCF,EAAMD,EAAUC,EAAMD,EAAUC,IAE7BI,KAAKE,KAAKN,EAAM,KAE3B,SAASO,EAAeC,GACpB,IAAIC,EAAYrB,EAAEoB,GAAME,KAAKpB,EAAUG,YAAc,IAAMH,EAAUI,sBAAsBQ,KAAK,MAChGb,EAAKsB,KAAK,CAAC,CACPC,WAAY,yCACZC,KAAM,CACFC,SAAUL,MAEd,GACHM,KAAK,SAASC,GACX,QAA0BC,IAAtBD,EAASlB,SACTV,EAAEoB,GAAME,KAAKpB,EAAUE,YAAY0B,OACnC9B,EAAEoB,GAAME,KAAKpB,EAAUK,OAAOwB,WAC3B,CACc,OAAbvB,GACAA,EAASwB,UAEb,IAAIC,EAAajC,EAAEoB,GAAME,KAAKpB,EAAUC,OAAO+B,IAAI,GAAGC,WAAW,MACjEF,EAAWG,OAAOC,OAAS,IAE3B,IAAIC,EAAU,CACVC,OAAQX,EAASW,OACjB7B,SAAUkB,EAASlB,UAEvBF,EAAW,IAAIgC,MAAMP,EAAY,CAC7BQ,KAAM,MACN3B,KAAMwB,EACNI,QAAS,CACLC,YAAY,EACZC,qBAAqB,EACrBC,OAAQ,CACJC,MAAO,CAAC,CACJC,WAAY,CACRC,SAAS,EACTC,YAAaC,EAAEC,KAAKC,WAAW,eAAgB,oBAEnDC,MAAO,CACHC,IAAK,EACLC,SAAU9C,EAAYmB,EAASlB,oBAQ1D8C,KAAK,SAASC,GACXzD,EAAEoB,GAAME,KAAKpB,EAAUE,YAAY0B,OACnC9B,EAAEoB,GAAME,KAAKpB,EAAUK,OAAOwB,SAkBtC,MAAO,CACH2B,KATO,SAAStC,GAChBpB,EAAE2D,UAAUC,MAAM,YAPL,SAASxC,GACtBpB,EAAEoB,GAAME,KAAKpB,EAAUG,aAAawD,GAAG,SAAU,WAC7C1C,EAAeC,KAMf0C,CAAW1C,GACPpB,EAAEoB,GAAME,KAAKpB,EAAUC,OAAO4D,QAC9B5C,EAAeC","sourcesContent":["define(['jquery', 'core/ajax', 'core/chartjs'], function($, Ajax){\n\n    var SELECTORS = {\n        CHART: \"#barChart\",\n        CHART_AREA: '#quiz-chart-area',\n        COURSE_LIST: '#quiz-course-list',\n        COURSE_LIST_SELECTED: 'option:selected',\n        ERROR: '.quiz-stats-error'\n    };\n    var barChart = null;\n    var respBar;\n    var getStepSize = function(datasets ) {\n        let max = 0;\n        let current;\n        datasets.forEach(function(data, index) {\n            current = Math.max.apply(Math, data.data);\n            max = current > max ? current : max;\n        });\n        return Math.ceil(max / 20);\n    };\n    function createBarChart(root) {\n        var course_id = $(root).find(SELECTORS.COURSE_LIST + ' ' + SELECTORS.COURSE_LIST_SELECTED).data('id');\n        Ajax.call([{\n            methodname: 'block_remuiblck_get_quiz_participation',\n            args: {\n                courseid: course_id\n            }\n        }])[0]\n        .done(function(response) {\n            if (response.datasets === undefined) {\n                $(root).find(SELECTORS.CHART_AREA).hide();\n                $(root).find(SELECTORS.ERROR).show();\n            } else {\n                if (barChart !== null) {\n                    barChart.destroy();\n                }\n                var barcontext = $(root).find(SELECTORS.CHART).get(0).getContext(\"2d\");\n                barcontext.canvas.height = 400;\n\n                var barData = {\n                    labels: response.labels,\n                    datasets: response.datasets\n                };\n                barChart = new Chart(barcontext, {\n                    type: 'bar',\n                    data: barData,\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        scales: {\n                            yAxes: [{\n                                scaleLabel: {\n                                    display: true,\n                                    labelString: M.util.get_string('noofstudents', 'block_remuiblck')\n                                },\n                                ticks: {\n                                    min: 0,\n                                    stepSize: getStepSize(response.datasets)\n                                }\n                            }]\n                        }\n                    }\n                });\n            }\n        })\n        .fail(function(ex) {\n            $(root).find(SELECTORS.CHART_AREA).hide();\n            $(root).find(SELECTORS.ERROR).show();\n        });\n    }\n\n    var initEvents = function(root) {\n        $(root).find(SELECTORS.COURSE_LIST).on('change', function () {\n            createBarChart(root);\n        });\n    };\n\n    var init = function(root) {\n        $(document).ready(function() {\n            initEvents(root);\n            if ($(root).find(SELECTORS.CHART).length) {\n                createBarChart(root);\n            }\n        });\n    }\n    return {\n        init: init\n    };\n});\n"],"file":"quizstats.min.js"}