{"version":3,"file":"manage_courses_view.min.js","sources":["../src/manage_courses_view.js"],"sourcesContent":["/* eslint-disable babel/no-unused-expressions */\n/* eslint-disable no-self-assign */\n/* eslint-disable no-unused-vars */\ndefine([\n    'jquery',\n    'core/ajax',\n    'core/notification',\n    'core/templates',\n    'block_remuiblck/slick',\n    'block_remuiblck/jquery-toolbar'\n], function(\n    $,\n    ajax,\n    Notification,\n    Templates,\n    toolbar\n) {\n    // Declair all required selectors\n    var SELECTORS = {\n        COURSES_LIST: '[data-region=\"manage-courses-list\"]',\n        COURSES_LIST_DECK: '#manage_courses .card-deck.dashboard-card-deck',\n        COURSE_MENU: '.coursemenubtn[data-region=\"managecourses\"]',\n        PAGES: '[data-region-pages]'\n    };\n\n    // Declair all required promises\n    var PROMISES = {\n        /**\n         * Get list of courses which user is enrolled as teacher\n         *\n         * @param {String} type        Type of view selected card|list|summary\n         * @param {Number} perpage     Number of courses per page\n         * @param {Number} currentpage Current page number\n         *\n         * @return {promise} Ajax promise call\n         */\n        GET_MANAGE_COURSES_LIST: function(type, perpage, currentpage) {\n            return ajax.call([{\n                methodname: 'block_remuiblck_get_manage_courses_list',\n                args: {\n                    type: type,\n                    perpage: perpage,\n                    currentpage: currentpage\n                }\n            }])[0];\n        }\n    };\n\n    // Declair all required templates\n    var TEMPLATES = {\n        MANAGE_COURSES_LIST: 'block_remuiblck/manage_courses_list_items'\n    };\n\n    /**\n     * Get extra data required for course list item\n     * @param  {array} courses courses array\n     * @return {array}         courses array with extra data\n     */\n    var extraData = function(courses) {\n        courses.enrollink = M.cfg.wwwroot + \"/user/index.php?id=\";\n        courses.enroltitle = M.util.get_string('enrolusers', 'core_enrol');\n\n        courses.graderreportlink = M.cfg.wwwroot + \"/grade/report/grader/index.php?id=\";\n        courses.graderreporttitle = M.util.get_string('graderreport', 'core_grades');\n\n        courses.activityreportlink = M.cfg.wwwroot + \"/report/outline/index.php?id=\";\n        courses.activityreporttitle = M.util.get_string('activityreport', 'moodle');\n\n        courses.editcourselink = M.cfg.wwwroot + \"/course/edit.php?id=\";\n        courses.editcoursetitle = M.util.get_string('editcourse', 'theme_remui');\n\n        courses.coursereporttitle = M.util.get_string('coursereport', 'moodle');\n\n        courses.courseviewlink = M.cfg.wwwroot + \"/course/view.php?id=\";\n        return courses;\n    };\n\n    /**\n     * Apply slick styling to courses list if user selects card view\n     * @param  {String} root Root element id\n     */\n    var applySlick = function(root) {\n        var colors = ['#f39f45', '#f95e5f', '#2fb0bf', '#2fb786', '#526069', '#46657d'];\n        $('#manage_courses .wdm-course-card-body').each(function(index, element) {\n            index >= colors.length ? index = index % colors.length : index = index;\n            $(element).css('background-color', colors[index]);\n        });\n        $('#manage_courses .dashboard-card-deck').css(\"overflow\", \"unset\");\n        $('#manage_courses .dashboard-card-deck').not('.slick-initialized').each(function(index, element) {\n            $(element).slick({\n                dots: false,\n                arrows: true,\n                infinite: false,\n                rtl: ($(\"html\").attr(\"dir\") == \"rtl\") ? true : false,\n                opacity: 0,\n                speed: 500,\n                slidesToShow: 3,\n                slidesToScroll: 3,\n                responsive: [{\n                    breakpoint: 1024,\n                    settings: {\n                        slidesToShow: 3,\n                        slidesToScroll: 3\n                    }\n                    }, {\n                    breakpoint: 800,\n                    settings: {\n                        slidesToShow: 2,\n                        slidesToScroll: 2\n                    }\n                    }, {\n                    breakpoint: 480,\n                    settings: {\n                        slidesToShow: 1,\n                        slidesToScroll: 1\n                    }\n                    }\n                ]\n            });\n            $(window).trigger('resize');\n        });\n    };\n\n    /**\n     * Load courses in course list view\n     * @param {String} root        Root element id\n     */\n    var loadCourses = function(root) {\n        var perpageprefdata = $('#manage_courses .filters #perpage').attr('data-value');\n        var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'card';\n        var perpage = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : perpageprefdata;\n        var currentpage = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 1;\n\n\n        PROMISES.GET_MANAGE_COURSES_LIST(type, perpage, currentpage).done(function(response) {\n            if (response.courses.length != 0) {\n                response = extraData(response);\n                response[type] = true;\n                $(root).find(SELECTORS.COURSES_LIST).data('currentpage', currentpage);\n                $(root).find(SELECTORS.COURSES_LIST).data('totalcourses', response.totalcourses);\n                $(root).find(SELECTORS.COURSES_LIST).data('totalpages', response.totalpages);\n            }\n            Templates.render(TEMPLATES.MANAGE_COURSES_LIST, response).done(function(html) {\n                $(root).find(SELECTORS.COURSES_LIST).html(html).attr('data-type', type);\n                $(root).find(SELECTORS.PAGES).text(M.util.get_string('showingfromto', 'block_remuiblck', {\n                    start: response.start,\n                    to: response.end,\n                    total: response.totalcourses\n                }));\n                if (type == 'card') {\n                    // applySlick(root);\n                }\n                $(root).find(SELECTORS.COURSES_LIST).find(SELECTORS.COURSE_MENU).each(function() {\n                    $(this).toolbar({\n                        content: $(this).data('toolbar'),\n                        position: 'bottom',\n                        style: 'primary',\n                        event: 'click',\n                        hideOnClick: true\n                    });\n                    // Fix redirect issue\n                    $(this).on('toolbarItemClick', function(e, el) {\n                        if (el.href) {\n                        window.location.href = el.href;\n                        }\n                    });\n                });\n            }).fail(Notification.exception);\n        }).fail(Notification.exception);\n    };\n\n    /**\n     * Initialize events\n     * @param  {String} root Root element id\n     */\n    var initialiseEvents = function(root) {\n        // Nothing to do here for now\n    };\n\n    /**\n     * Initialise manage courses view\n     * @param  {String} root Root element id\n     */\n    var init = function(root) {\n        initialiseEvents(root);\n    };\n    return {\n        init: init,\n        loadCourses: loadCourses\n    };\n});\n"],"names":["define","$","ajax","Notification","Templates","toolbar","SELECTORS","PROMISES","type","perpage","currentpage","call","methodname","args","TEMPLATES","extraData","courses","enrollink","M","cfg","wwwroot","enroltitle","util","get_string","graderreportlink","graderreporttitle","activityreportlink","activityreporttitle","editcourselink","editcoursetitle","coursereporttitle","courseviewlink","init","root","loadCourses","perpageprefdata","attr","arguments","length","undefined","done","response","find","data","totalcourses","totalpages","render","html","text","start","to","end","total","each","this","content","position","style","event","hideOnClick","on","e","el","href","window","location","fail","exception"],"mappings":"AAGAA,6CAAO,CACH,SACA,YACA,oBACA,iBACA,wBACA,mCACD,SACCC,EACAC,KACAC,aACAC,UACAC,aAGIC,uBACc,sCADdA,sBAGa,8CAHbA,gBAIO,sBAIPC,iCAUyB,SAASC,KAAMC,QAASC,oBACtCR,KAAKS,KAAK,CAAC,CACdC,WAAY,0CACZC,KAAM,CACFL,KAAMA,KACNC,QAASA,QACTC,YAAaA,gBAEjB,IAKRI,8BACqB,4CAQrBC,UAAY,SAASC,gBACrBA,QAAQC,UAAYC,EAAEC,IAAIC,QAAU,sBACpCJ,QAAQK,WAAaH,EAAEI,KAAKC,WAAW,aAAc,cAErDP,QAAQQ,iBAAmBN,EAAEC,IAAIC,QAAU,qCAC3CJ,QAAQS,kBAAoBP,EAAEI,KAAKC,WAAW,eAAgB,eAE9DP,QAAQU,mBAAqBR,EAAEC,IAAIC,QAAU,gCAC7CJ,QAAQW,oBAAsBT,EAAEI,KAAKC,WAAW,iBAAkB,UAElEP,QAAQY,eAAiBV,EAAEC,IAAIC,QAAU,uBACzCJ,QAAQa,gBAAkBX,EAAEI,KAAKC,WAAW,aAAc,eAE1DP,QAAQc,kBAAoBZ,EAAEI,KAAKC,WAAW,eAAgB,UAE9DP,QAAQe,eAAiBb,EAAEC,IAAIC,QAAU,uBAClCJ,eAgHJ,CACHgB,KAJO,SAASC,QAKhBC,YA7Dc,SAASD,UACnBE,gBAAkBlC,EAAE,qCAAqCmC,KAAK,cAC9D5B,KAAO6B,UAAUC,OAAS,QAAsBC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,OAC3E5B,QAAU4B,UAAUC,OAAS,QAAsBC,IAAjBF,UAAU,GAAmBA,UAAU,GAAKF,gBAC9EzB,YAAc2B,UAAUC,OAAS,QAAsBC,IAAjBF,UAAU,GAAmBA,UAAU,GAAK,EAGtF9B,iCAAiCC,KAAMC,QAASC,aAAa8B,MAAK,SAASC,UACxC,GAA3BA,SAASzB,QAAQsB,UACjBG,SAAW1B,UAAU0B,WACZjC,OAAQ,EACjBP,EAAEgC,MAAMS,KAAKpC,wBAAwBqC,KAAK,cAAejC,aACzDT,EAAEgC,MAAMS,KAAKpC,wBAAwBqC,KAAK,eAAgBF,SAASG,cACnE3C,EAAEgC,MAAMS,KAAKpC,wBAAwBqC,KAAK,aAAcF,SAASI,aAErEzC,UAAU0C,OAAOhC,8BAA+B2B,UAAUD,MAAK,SAASO,MACpE9C,EAAEgC,MAAMS,KAAKpC,wBAAwByC,KAAKA,MAAMX,KAAK,YAAa5B,MAClEP,EAAEgC,MAAMS,KAAKpC,iBAAiB0C,KAAK9B,EAAEI,KAAKC,WAAW,gBAAiB,kBAAmB,CACrF0B,MAAOR,SAASQ,MAChBC,GAAIT,SAASU,IACbC,MAAOX,SAASG,gBAKpB3C,EAAEgC,MAAMS,KAAKpC,wBAAwBoC,KAAKpC,uBAAuB+C,MAAK,WAClEpD,EAAEqD,MAAMjD,QAAQ,CACZkD,QAAStD,EAAEqD,MAAMX,KAAK,WACtBa,SAAU,SACVC,MAAO,UACPC,MAAO,QACPC,aAAa,IAGjB1D,EAAEqD,MAAMM,GAAG,oBAAoB,SAASC,EAAGC,IACnCA,GAAGC,OACPC,OAAOC,SAASF,KAAOD,GAAGC,eAInCG,KAAK/D,aAAagE,cACtBD,KAAK/D,aAAagE"}