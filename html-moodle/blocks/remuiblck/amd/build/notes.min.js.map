{"version":3,"file":"notes.min.js","sources":["../src/notes.js"],"sourcesContent":["define(['jquery', 'core/ajax'], function($, Ajax) {\n     /* Add Notes Block */\n     var SELECTORS = {\n        ADD_NOTE_BUTTON: '.add-notes-button',\n        ADD_NOTE_SELECT: '.add-notes-select',\n        SITE_NOTE: '.site-note',\n        COURSE_NOTE: '.course-note',\n        PERSONAL_NOTE: '.personal-note',\n        STUDENT_LABEL: '.select2-studentlist-label',\n        STUDENT_LIST: '.select2-studentlist',\n        SELECT_STUDENT_NOTE: '.select-note-student',\n        ADD_NOTES_BUTTON_WRAPPER: \".add-notes-button-wrapper\",\n    };\n    if ($(SELECTORS.ADD_NOTE_SELECT).length) {\n        $(SELECTORS.ADD_NOTE_BUTTON).hide();\n        $(SELECTORS.STUDENT_LABEL).hide();\n        $(SELECTORS.STUDENT_LIST).hide();\n        var courseId, studentCount, userId, courseName;\n\n        $(SELECTORS.ADD_NOTE_SELECT + ' select').on('change', function() {\n            $(SELECTORS.ADD_NOTE_BUTTON).hide();\n            $(SELECTORS.SELECT_STUDENT_NOTE).removeClass('d-none');\n            courseId = $(this).children(\":selected\").attr(\"id\");\n            courseName = $(this).children(\":selected\").text();\n            if (courseId === undefined) {\n                $(SELECTORS.STUDENT_LABEL).hide();\n                $(SELECTORS.STUDENT_LIST).empty();\n                $(SELECTORS.STUDENT_LIST).hide();\n                return;\n            }\n            Ajax.call([{\n                methodname: 'block_remuiblck_get_enrolled_users_by_course',\n                args: {\n                    courseid: courseId\n                }\n            }])[0].done(function(response) {\n                studentCount = Object.keys(response).length;\n                $(SELECTORS.STUDENT_LABEL).show();\n                $(SELECTORS.STUDENT_LIST).show();\n                $(SELECTORS.STUDENT_LIST).empty();\n                if (studentCount) {\n                    $(SELECTORS.STUDENT_LIST).append('<option>' + M.util.get_string(\n                        \"selectastudent\", \"block_remuiblck\") + ' (' + M.util.get_string(\"total\", \"moodle\") +\n                        ': ' + studentCount + ')</option>');\n\n                    $.each(response, function(index, student) {\n                        $(SELECTORS.STUDENT_LIST).append('<option value=\"' + student.id + '\">' + student.fullname + '</option>');\n                    });\n\n                } else {\n                    $(SELECTORS.STUDENT_LIST).append('<option>' + M.util.get_string(\"nousersenrolledincourse\",\n                        \"block_remuiblck\", courseName) + '</option>');\n                }\n\n            }).fail(function(ex) {\n                $(SELECTORS.STUDENT_LIST).html('<option>' + ex.message + '</option>');\n            });\n        });\n\n        $(SELECTORS.STUDENT_LIST).on('change', function() {\n            $(SELECTORS.ADD_NOTE_BUTTON).show();\n            $(SELECTORS.ADD_NOTES_BUTTON_WRAPPER).removeClass('d-none');\n            userId = $(this).find('option:selected').val();\n            var notesLink = M.cfg.wwwroot + '/notes/edit.php?courseid=' + courseId +\n                '&userid=' + userId + '&publishstate=site';\n            $(SELECTORS.ADD_NOTE_BUTTON + ' ' + SELECTORS.SITE_NOTE).attr('href', notesLink);\n            notesLink = M.cfg.wwwroot + '/notes/edit.php?courseid=' + courseId +\n                '&userid=' + userId + '&publishstate=public';\n            $(SELECTORS.ADD_NOTE_BUTTON + ' ' + SELECTORS.COURSE_NOTE).attr('href', notesLink);\n            notesLink = M.cfg.wwwroot + '/notes/edit.php?courseid=' + courseId +\n                '&userid=' + userId + '&publishstate=draft';\n            $(SELECTORS.ADD_NOTE_BUTTON + ' ' + SELECTORS.PERSONAL_NOTE).attr('href', notesLink);\n        });\n    }\n    /* End - Add Notes Block */\n});\n"],"names":["define","$","Ajax","courseId","studentCount","userId","courseName","SELECTORS","length","hide","on","removeClass","this","children","attr","text","undefined","empty","call","methodname","args","courseid","done","response","Object","keys","show","append","M","util","get_string","each","index","student","id","fullname","fail","ex","html","message","find","val","notesLink","cfg","wwwroot"],"mappings":"AAAAA,+BAAO,CAAC,SAAU,cAAc,SAASC,EAAGC,UAiBhCC,SAAUC,aAAcC,OAAQC,WAfnCC,0BACgB,oBADhBA,0BAEgB,oBAFhBA,oBAGU,aAHVA,sBAIY,eAJZA,wBAKc,iBALdA,wBAMc,6BANdA,uBAOa,uBAPbA,8BAQoB,uBARpBA,mCASyB,4BAE1BN,EAAEM,2BAA2BC,SAC7BP,EAAEM,2BAA2BE,OAC7BR,EAAEM,yBAAyBE,OAC3BR,EAAEM,wBAAwBE,OAG1BR,EAAEM,0BAA4B,WAAWG,GAAG,UAAU,cAClDT,EAAEM,2BAA2BE,OAC7BR,EAAEM,+BAA+BI,YAAY,UAC7CR,SAAWF,EAAEW,MAAMC,SAAS,aAAaC,KAAK,MAC9CR,WAAaL,EAAEW,MAAMC,SAAS,aAAaE,YAC1BC,IAAbb,gBACAF,EAAEM,yBAAyBE,OAC3BR,EAAEM,wBAAwBU,aAC1BhB,EAAEM,wBAAwBE,OAG9BP,KAAKgB,KAAK,CAAC,CACPC,WAAY,+CACZC,KAAM,CACFC,SAAUlB,aAEd,GAAGmB,MAAK,SAASC,UACjBnB,aAAeoB,OAAOC,KAAKF,UAAUf,OACrCP,EAAEM,yBAAyBmB,OAC3BzB,EAAEM,wBAAwBmB,OAC1BzB,EAAEM,wBAAwBU,QACtBb,cACAH,EAAEM,wBAAwBoB,OAAO,WAAaC,EAAEC,KAAKC,WACjD,iBAAkB,mBAAqB,KAAOF,EAAEC,KAAKC,WAAW,QAAS,UACzE,KAAO1B,aAAe,cAE1BH,EAAE8B,KAAKR,UAAU,SAASS,MAAOC,SAC7BhC,EAAEM,wBAAwBoB,OAAO,kBAAoBM,QAAQC,GAAK,KAAOD,QAAQE,SAAW,iBAIhGlC,EAAEM,wBAAwBoB,OAAO,WAAaC,EAAEC,KAAKC,WAAW,0BAC5D,kBAAmBxB,YAAc,gBAG1C8B,MAAK,SAASC,IACbpC,EAAEM,wBAAwB+B,KAAK,WAAaD,GAAGE,QAAU,mBAIjEtC,EAAEM,wBAAwBG,GAAG,UAAU,WACnCT,EAAEM,2BAA2BmB,OAC7BzB,EAAEM,oCAAoCI,YAAY,UAClDN,OAASJ,EAAEW,MAAM4B,KAAK,mBAAmBC,UACrCC,UAAYd,EAAEe,IAAIC,QAAU,4BAA8BzC,SAC1D,WAAaE,OAAS,qBAC1BJ,EAAEM,0BAA4B,IAAMA,qBAAqBO,KAAK,OAAQ4B,WACtEA,UAAYd,EAAEe,IAAIC,QAAU,4BAA8BzC,SACtD,WAAaE,OAAS,uBAC1BJ,EAAEM,0BAA4B,IAAMA,uBAAuBO,KAAK,OAAQ4B,WACxEA,UAAYd,EAAEe,IAAIC,QAAU,4BAA8BzC,SACtD,WAAaE,OAAS,sBAC1BJ,EAAEM,0BAA4B,IAAMA,yBAAyBO,KAAK,OAAQ4B"}