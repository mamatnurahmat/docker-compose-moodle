define("block_remuiblck/course_progress",["jquery","core/ajax","core/notification","core/templates","core/modal_factory","core/modal_events","core/modal_save_cancel","block_remuiblck/dataTables.bootstrap4","block_remuiblck/jquery-asPieProgress","block_remuiblck/aspieprogress"],(function($,Ajax,Notification,Templates,ModalFactory,ModalEvents){var SELECTORS={ROOT:"",TABLE:"#DataTables_Teacher",DATA_TABLE:"#DataTables_Teacher_wrapper",STUDENT_PROGRESS_ELEMENT:".student_progress_ele",STUDENT_PROGRESS_TABLE:"#wdmCourseProgressTable",COURSE_NAME:".wdm_course_name.has-student",MESSAGE_HIDDEN:"#messageidhidden",MESSAGE_AREA:"#messagearea",TOGGLE_DESCRIPTION:".toggle-desc",REVERT:"#courserevertbtn",CUSTOM_MESSAGE:".custom-message",MESSAGE_SEND:".send-message",BLOCK_PROCESSING:".block-processing",ALWAYS_LOAD:"#always-load-progress",COURSE_PROGRESSING:".course-progress-settings",LOAD_COURSE_PROGRESS:"#load-progress",PANEL:".panel",PANEL_HEADING:".panel-heading",PANEL_ACTIONS:"panel-actions",BLOCK_PROCESSING:".block-processing",STUDENT_PROOGRESS_VISIBLE:"student-progress-visible",DATATABLE_HEADER:"#datatable_header"},DATA={coursesTable:!1,alwaysloadwarning:!1};console.log("testing");var courseProgressTable,PROMISES_GET_COURSES=function(search,length,start,order,loadProgress){return Ajax.call([{methodname:"block_remuiblck_get_course_progress_list",args:{search:search,length:length,start:start,order:order,loadprogress:loadProgress}}])[0]},PROMISES_GET_COURSE_PROGRESS=function(courseid){return Ajax.call([{methodname:"block_remuiblck_get_course_progress",args:{courseid:courseid}}])[0]},PROMISES_SEND_MESSAGE=function(studentid,messagetext){return Ajax.call([{methodname:"block_remuiblck_send_message",args:{studentid:studentid,messagetext:messagetext}}])[0]};function createDatatable(root){DATA.coursesTable=$(root).show().find(SELECTORS.TABLE).DataTable({paging:!0,pagingType:"simple_numbers",autoWidth:!0,scrollX:!0,bPaginate:!0,bServerSide:!0,language:{searchPlaceholder:M.util.get_string("searchforcourses","block_remuiblck"),emptyTable:M.util.get_string("nomatchingcourses","core_backup"),lengthMenu:M.util.get_string("show","moodle")+" _MENU_ "+M.util.get_string("entries","moodle"),info:M.util.get_string("datatableinfo","block_remuiblck"),search:M.util.get_string("search","block_remuiblck")+":",paginate:{first:"<span class='edw-icon edw-icon-Left-Arrow'></span>",previous:"<span class='edw-icon edw-icon-Left-Arrow'></span>",next:"<span class='edw-icon edw-icon-Right-Arrow'></span>",last:"<span class='edw-icon edw-icon-Right-Arrow'></span>"}},ajax:function(data,callback,settings){$(root).find(SELECTORS.BLOCK_PROCESSING).addClass("show");let loadCourseProgress=$(root+" "+SELECTORS.COURSE_PROGRESSING).is(".load-progress");PROMISES_GET_COURSES(data.search.value,data.length,data.start,data.order[0],loadCourseProgress).done((function(response){if(0==response.recordsTotal)return response.data=[],callback(response),void $(root).find(SELECTORS.BLOCK_PROCESSING).removeClass("show");response.data=function(courses){var data=[];return courses.forEach((function(course){var dData={};dData.index='<div class="w-50" tabindex="0">'+course.index+"</div>",course.enrolledStudents>0?dData.course='<div class="wdm_course_name has-student" data-courseid="'+course.id+'"><a href="javascript:void(0)">'+course.fullname+"</a></div>":dData.course='<div class="wdm_course_name" data-courseid="'+course.id+'" >'+course.fullname+"</div>",dData.startdate=course.startdate,dData.students='<div class="w-100"><span class="w-full pl-40">'+course.enrolledStudents+"</span></div>",-1==course.percentage?dData.progress="":dData.progress='<td class="w-100 px-10"><div class="pie-progress pie-progress-xs m-0 w-35" data-plugin="pieProgress" data-valuemax="50" data-barcolor="#11c26d" data-size="20" data-barsize="3" data-goal="35" aria-valuenow="'+course.percentage+'" role="progressbar" style="max-width: 35px!important;"><div class="pie-progress-content" style="z-index:2;"> </div> <span class=" progress-percent" style="margin-left: 50px;position: absolute;top: 8px;">'+course.percentage+"%</span> </div></td>",data.push(dData)})),data}(response.courses),callback(response),$(root).find(SELECTORS.BLOCK_PROCESSING).removeClass("show")})).fail(Notification.exception)},columns:[{data:"index"},{data:"course"},{data:"startdate"},{data:"students",orderable:!1},{data:"progress",orderable:!1}],responsive:!0,drawCallback:function(settings){createPieProgress(""),$(DATA.coursesTable.table().header()).addClass("h-semibold-6")}})}function createPieProgress(target){var element=$(SELECTORS.ROOT);""!=target&&(element=element.find(target)),element.find(".pie-progress").asPieProgress({namespace:"pie-progress",speed:30,classes:{svg:"pie-progress-svg",element:"pie-progress",number:"pie-progress-number",content:"pie-progress-content"}})}function sendMessageToUser(studentid,message){PROMISES_SEND_MESSAGE(studentid,message).done((function(){$(SELECTORS.ROOT).find(SELECTORS.MESSAGE_HIDDEN).val(""),$(SELECTORS.ROOT).find(SELECTORS.MESSAGE_AREA).val(""),$(SELECTORS.ROOT).find(".close-message").click()})).fail((function(ex){Notification.exception(ex),$(SELECTORS.ROOT).find("div#analysis-chart-area").hide()}))}function toggleAlwaysLoading(checked){M.util.set_user_preference("always-load-progress",checked),$(SELECTORS.ROOT).find(SELECTORS.COURSE_PROGRESSING).toggleClass("always-loading",checked),$(SELECTORS.ROOT).find(SELECTORS.COURSE_PROGRESSING).toggleClass("load-progress",checked),DATA.coursesTable.draw(!1)}function initializeEvents(root){$("body").on("click",root+" "+SELECTORS.COURSE_NAME,(function(){!function(courseid){$(SELECTORS.ROOT).find(SELECTORS.BLOCK_PROCESSING).addClass("show"),PROMISES_GET_COURSE_PROGRESS(courseid).done((function(response){Templates.render("block_remuiblck/course_progress_view",response).done((function(html,js){$(SELECTORS.ROOT).find(SELECTORS.DATA_TABLE).hide(),Templates.replaceNodeContents($(SELECTORS.ROOT).find(SELECTORS.STUDENT_PROGRESS_ELEMENT),html,js),createPieProgress(SELECTORS.STUDENT_PROGRESS_ELEMENT),courseProgressTable=$(SELECTORS.ROOT).find(SELECTORS.STUDENT_PROGRESS_TABLE).DataTable({scrollY:"300px",scrollCollapse:!0,paging:!1,retrieve:!0,lengthchange:!1,autoWidth:!0,scrollX:!0,search:"Fred",info:!1,language:{searchPlaceholder:"Search"},responsive:!0}),$(SELECTORS.ROOT).find("div.dataTables_filter input").addClass("form-control"),$(SELECTORS.ROOT).find("div.dataTables_length select").addClass("form-control"),$(SELECTORS.ROOT).addClass(SELECTORS.STUDENT_PROOGRESS_VISIBLE),$(SELECTORS.ROOT).find(SELECTORS.BLOCK_PROCESSING).removeClass("show"),$("html, body").animate({scrollTop:$(SELECTORS.ROOT).offset().top-120},300)})).fail((function(){}))})).fail((function(){$(SELECTORS.ROOT).find("div#analysis-chart-area").hide()}))}($(this).data("courseid"))})).on("click",root+" "+SELECTORS.REVERT,(function(){courseProgressTable.destroy(),$(root).find(SELECTORS.STUDENT_PROGRESS_ELEMENT).empty(),$(root).find(SELECTORS.DATA_TABLE).show(),$(root).removeClass(SELECTORS.STUDENT_PROOGRESS_VISIBLE),$("html, body").animate({scrollTop:$(SELECTORS.ROOT).offset().top-120},300)})).on("click",root+" "+SELECTORS.CUSTOM_MESSAGE,(function(){var studentid=$(this).data("studentid");$(SELECTORS.MESSAGE_HIDDEN).val(studentid)})).on("click",root+" "+SELECTORS.MESSAGE_SEND,(function(){var studentid=$(root).find(SELECTORS.MESSAGE_HIDDEN).val(),message=$(root).find(SELECTORS.MESSAGE_AREA).val();""!=message?sendMessageToUser(studentid,message):$(SELECTORS.MESSAGE_AREA).focus()})).on("click",SELECTORS.STUDENT_PROGRESS_ELEMENT+" "+SELECTORS.TOGGLE_DESCRIPTION,(function(){$(this).toggleClass("fa-plus"),$(this).toggleClass("fa-minus"),$(this).parents(SELECTORS.STUDENT_PROGRESS_ELEMENT).find(".panel-body").toggleClass("show")})).on("change",root+" "+SELECTORS.ALWAYS_LOAD,(function(){var checkbox=$(this),checked=$(this).is(":checked");!DATA.alwaysloadwarning&&checked?ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:M.util.get_string("alwaysload","block_remuiblck"),body:M.util.get_string("alwaysloadwarning","block_remuiblck")}).then((function(modal){var modalRoot=modal.getRoot();modalRoot.on(ModalEvents.save,(function(){DATA.alwaysloadwarning=!0,M.util.set_user_preference("always-load-warning",!0),toggleAlwaysLoading(checked),modal.destroy()})),modalRoot.on(ModalEvents.cancel,(function(){checkbox.prop("checked",!1)})),modal.show()})):toggleAlwaysLoading(checked)})).on("click",root+" "+SELECTORS.LOAD_COURSE_PROGRESS,(function(){$(root).find(SELECTORS.COURSE_PROGRESSING).addClass("load-progress"),DATA.coursesTable.draw(!1)})),$(root+" "+SELECTORS.TABLE).on("order.dt",(function(){createPieProgress("")})),$(root+" "+SELECTORS.STUDENT_PROGRESS_TABLE).on("order.dt",(function(){createPieProgress("")}))}var updateContainers=function(root){let button=$(root).find(SELECTORS.COURSE_PROGRESSING).detach(),panelHeading=$(root).closest(SELECTORS.PANEL).find(SELECTORS.PANEL_HEADING),panelActions=$(panelHeading).find("."+SELECTORS.PANEL_ACTIONS);0==panelActions.length&&(panelActions=$('<div class="'+SELECTORS.PANEL_ACTIONS+'"></div>'),panelHeading.append(panelActions)),$(SELECTORS.DATATABLE_HEADER).append(button),button.removeClass("d-none").addClass("d-flex");let taskProcessing=$(root).find(SELECTORS.BLOCK_PROCESSING).detach();$(panelHeading).parent(SELECTORS.PANEL).prepend(taskProcessing)};return{init:function(root){let alwaysloadwarning=arguments.length>1&&void 0!==arguments[1]&&arguments[1];SELECTORS.ROOT=root,DATA.alwaysloadwarning=alwaysloadwarning,$(document).ready((function(){createPieProgress(""),createDatatable(root),updateContainers(root),initializeEvents(root)}))}}}));

//# sourceMappingURL=course_progress.min.js.map