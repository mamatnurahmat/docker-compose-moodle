define("block_remuiblck/courseanalytics",["block_remuiblck/jquery","core/ajax","block_remuiblck/chartjs","core/custom_interaction_events","block_remuiblck/events"],(function($,Ajax,Chart,CustomEvents,RemuiblckEvents){var SELECTORS_PAGINATE="[data-action-paginate]",SELECTORS_NEXT="[data-next]",SELECTORS_PREVIOUS="[data-previous]",SELECTORS_CHARTPAGINATION=".analysis-chart-pagination",SELECTORS_PAGES="[data-region-pages]",SELECTORS_PER_PAGE_FILTER='[data-region="per-page-filter"]',SELECTORS_FILTER_OPTION="[data-value]";window.analysisChart=null;var analysisBar,pageNumber=1,maxPage=1;function updateBars(root,totalBars){var limit=function(perPage){var limit={start:0,end:0};return null==analysisBar.labels?limit:analysisBar.labels.length<=perPage?(limit.start=1,limit.end=analysisBar.labels.length,limit):(limit.start=1==pageNumber?1:(pageNumber-1)*perPage+1,limit.end=pageNumber*perPage,analysisBar.labels.length<limit.end&&(limit.end=analysisBar.labels.length),limit)}(totalBars);$(root).find(SELECTORS_PAGES).text(M.util.get_string("showingfromto","block_remuiblck",{start:limit.start,to:limit.end,total:analysisBar.labels.length})),analysisChart.data.labels=[],analysisChart.data.datasets.forEach((function(dataset){dataset.data=[]})),analysisChart.update();for(var i=limit.start-1;i<=limit.end;i++)analysisChart.data.labels.push(analysisBar.labels[i]),analysisChart.data.datasets.forEach((function(dataset,index){dataset.data.push(analysisBar.datasets[index].data[i])})),analysisChart.update()}function generatePagination(root,perPage){null!=analysisBar.labels?(pageNumber=1,$(root).find(SELECTORS_CHARTPAGINATION).removeClass("d-none"),maxPage=analysisBar.labels.length>perPage?Math.round(analysisBar.labels.length/perPage):1,updateBars(root,perPage)):$(root).find(SELECTORS_CHARTPAGINATION).addClass("d-none")}function createAnalysisChart(root){(function(root){var course_id=$(root).find("#coursecategorylist option:selected").data("id");return Ajax.call([{methodname:"block_remuiblck_get_course_analytics",args:{courseid:course_id}}])[0]})(root).done((function(response){analysisBar=response,pageNumber=1,null!==analysisChart&&analysisChart.destroy(),response.error?($(root).find("#highestactivity").html(""),$(root).find("#lowestactivity").html(""),$(root).find("#highestgrade").html("0"),$(root).find("#lowestgrade").html("0"),$(root).find("#averagegrade").html("0")):($(root).find("#highestactivity").html(analysisBar.maxactivityname),$(root).find("#lowestactivity").html(analysisBar.minactivityname),$(root).find("#highestgrade").html(analysisBar.highest),$(root).find("#lowestgrade").html(analysisBar.lowest),$(root).find("#averagegrade").html(analysisBar.average));var context=$(root).find("#analysischart").get(0).getContext("2d"),datasets=[];null!=response.datasets&&response.datasets.forEach((function(dataset){datasets.push({data:[],backgroundColor:dataset.backgroundColor,label:dataset.label})})),context.canvas.height=400,analysisChart=new Chart(context,{data:{labels:[],datasets:datasets},type:"bar",options:{responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!0},hover:{animationDuration:0},layout:{padding:{top:20}},legend:{position:"bottom",labels:{padding:20,fontSize:12}},animation:{duration:300,easing:"easeInOutQuad",onComplete:function(){var chartInstance=this.chart,ctx=chartInstance.ctx;ctx.font=Chart.helpers.fontString(Chart.defaults.global.defaultFontSize,Chart.defaults.global.defaultFontStyle,Chart.defaults.global.defaultFontFamily),ctx.textAlign="center",ctx.textBaseline="bottom",this.data.datasets.forEach((function(dataset,i){var meta=chartInstance.controller.getDatasetMeta(i);1!=meta.hidden&&meta.data.forEach((function(bar,index){var data=dataset.data[index];ctx.fillText(data,bar._model.x,bar._model.y-5)}))}))}},scales:{xAxes:[{display:!1,gridLines:{display:!0},barThickness:38}],yAxes:[{ticks:{beginAtZero:!0},gridLines:{display:!0}}]}}}),generatePagination(root,getCourseAnalyticsPerPage(root))})).fail((function(xhr,status,error){$(root).find("div#analysis-chart-area").hide()}))}var getCourseAnalyticsPerPage=function(root){return $(root).find(SELECTORS_PER_PAGE_FILTER).find(SELECTORS_FILTER_OPTION+".active").data("value")};function initEvents(root){!function(root){var courseAnalyticsPerPageFilterContainer=$(root).find(SELECTORS_PER_PAGE_FILTER);CustomEvents.define(courseAnalyticsPerPageFilterContainer,[CustomEvents.events.activate]),courseAnalyticsPerPageFilterContainer.on(CustomEvents.events.activate,SELECTORS_FILTER_OPTION,(function(e,data){data.originalEvent.preventDefault();var option=$(e.target).closest(SELECTORS_FILTER_OPTION);option.hasClass("active")||($(e.target).trigger(RemuiblckEvents.COURSE_ANALYTICS_PAGE_FILTER_CHANGE),M.util.set_user_preference("courseanalyticsperpage",option.data("value")),generatePagination(root,option.data("value")))}))}(root),$("body").on("click",root+" "+SELECTORS_PAGINATE,(function(){if($(this).is(SELECTORS_NEXT)){if(pageNumber==maxPage)return;pageNumber++}else{if(!$(this).is(SELECTORS_PREVIOUS))return;if(1==pageNumber)return;pageNumber--}var perPage=getCourseAnalyticsPerPage(root);updateBars(root,perPage)})),$("body").on("change",root+" #coursecategorylist",(function(){createAnalysisChart(root)}))}return{init:function(root){$(document).ready((function(){initEvents(root),$(root).find("#analysischart").length&&createAnalysisChart(root)}))}}}));

//# sourceMappingURL=courseanalytics.min.js.map