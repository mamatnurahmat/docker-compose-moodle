{"version":3,"file":"quizstats.min.js","sources":["../src/quizstats.js"],"sourcesContent":["/* eslint-disable no-console */\n/* eslint-disable no-undef */\ndefine(['block_remuiblck/jquery', 'core/ajax', 'block_remuiblck/chartjs'], function ($, Ajax) {\n\n    var SELECTORS = {\n        ROOT: null,\n        CHART: \"#barChart\",\n        CHART_AREA: '#quiz-chart-area',\n        COURSE_LIST: '#quiz-course-list',\n        QUIZ_LIST: '#quiz-list',\n        LIST_SELECTED: 'option:selected',\n        ERROR: '.quiz-stats-error'\n    };\n    var barChart = null;\n    var getStepSize = function (datasets) {\n        let max = 0;\n        let current;\n        datasets.forEach(function (data) {\n            current = Math.max.apply(Math, data.data);\n            max = current > max ? current : max;\n        });\n        return Math.ceil(max / 20);\n    };\n    /**\n     *\n     */\n    function createBarChart() {\n        var courseId = getSelectedCourseID();\n        var quizId = getSelectedQuizID();\n\n        Ajax.call([{\n            methodname: 'block_remuiblck_get_quiz_participation',\n            args: {\n                courseid: courseId,\n                quizid: quizId\n            }\n        }])[0]\n            .done(function (response) {\n                if (response.datasets === undefined) {\n                    $(SELECTORS.ROOT).find(SELECTORS.CHART_AREA).hide();\n                    $(SELECTORS.ROOT).find(SELECTORS.ERROR).show();\n                } else {\n                    if (barChart !== null) {\n                        barChart.destroy();\n                    }\n                    var barcontext = $(SELECTORS.ROOT).find(SELECTORS.CHART).get(0).getContext(\"2d\");\n                    barcontext.canvas.height = 400;\n                    var barData = {\n                        labels: response.labels,\n                        datasets: response.datasets\n                    };\n                    barChart = new Chart(barcontext, {\n                        type: 'bar',\n                        data: barData,\n                        options: {\n                            responsive: true,\n                            maintainAspectRatio: false,\n                            scales: {\n                                yAxes: [{\n                                    scaleLabel: {\n                                        display: true,\n                                        labelString: M.util.get_string('noofstudents', 'block_remuiblck'),\n                                        fontColor: '#4C5A73',\n                                    },\n                                    ticks: {\n                                        min: 0,\n                                        stepSize: getStepSize(response.datasets)\n                                    },\n                                    gridLines: {\n                                        drawBorder: false,\n                                    }\n                                }],\n                                xAxes: [{\n                                    gridLines: {\n                                        drawBorder: false,\n                                        display: true,\n                                        borderDash: [8, 4],\n                                        color: \"#EBF0F9\"\n                                    },\n                                    barThickness: 38,\n                                }]\n                            },\n                            legend: {\n                                display: true,\n                                position: 'bottom',\n                                align: 'left',\n                                labels: {\n                                    fontColor: '#4C5A73',\n                                }\n                            }\n                        }\n                    });\n                }\n            })\n            .fail(function () {\n                $(SELECTORS.ROOT).find(SELECTORS.CHART_AREA).hide();\n                $(SELECTORS.ROOT).find(SELECTORS.ERROR).show();\n            });\n    }\n\n    var getSelectedCourseID = function () {\n        return $(SELECTORS.ROOT).find(SELECTORS.COURSE_LIST + ' ' + SELECTORS.LIST_SELECTED).data('courseid');\n    };\n    var getSelectedQuizID = function () {\n        return $(SELECTORS.ROOT).find(SELECTORS.QUIZ_LIST + ' ' + SELECTORS.LIST_SELECTED).data('quizid');\n    };\n    var populateQuizSelector = function () {\n        var courseId = getSelectedCourseID();\n        Ajax.call([{\n            methodname: 'block_remuiblck_get_quizzes_of_course',\n            args: {\n                courseid: courseId\n            }\n        }])[0]\n            .done(function (response) {\n                var option = \"\";\n                for (var i = 0; i < response.length; i++) {\n                    option = option + \"<option data-id='\" + response[i].courseid + \"' data-quizid='\" + response[i].quizid + \"'>\";\n                    option = option + response[i].quizname + \"</option>\";\n                }\n                $(SELECTORS.ROOT).find(SELECTORS.QUIZ_LIST).empty().append(option);\n                createBarChart();\n            })\n            .fail(function () {\n                $(SELECTORS.ROOT).find(SELECTORS.CHART_AREA).hide();\n                $(SELECTORS.ROOT).find(SELECTORS.ERROR).show();\n            });\n    };\n    var initEvents = function () {\n        $(SELECTORS.ROOT).find(SELECTORS.COURSE_LIST).on('change', function () {\n            populateQuizSelector();\n        });\n        $(SELECTORS.ROOT).find(SELECTORS.QUIZ_LIST).on('change', function () {\n            createBarChart();\n        });\n    };\n\n    var init = function (root) {\n        SELECTORS.ROOT = root;\n        $(document).ready(function () {\n            initEvents();\n            if ($(SELECTORS.ROOT).find(SELECTORS.CHART).length) {\n                createBarChart();\n            }\n        });\n    };\n    return {\n        init: init\n    };\n});\n"],"names":["define","$","Ajax","SELECTORS","ROOT","CHART","CHART_AREA","COURSE_LIST","QUIZ_LIST","LIST_SELECTED","ERROR","barChart","getStepSize","datasets","current","max","forEach","data","Math","apply","ceil","createBarChart","courseId","getSelectedCourseID","quizId","getSelectedQuizID","call","methodname","args","courseid","quizid","done","response","undefined","find","hide","show","destroy","barcontext","get","getContext","canvas","height","barData","labels","Chart","type","options","responsive","maintainAspectRatio","scales","yAxes","scaleLabel","display","labelString","M","util","get_string","fontColor","ticks","min","stepSize","gridLines","drawBorder","xAxes","borderDash","color","barThickness","legend","position","align","fail","initEvents","on","option","i","length","quizname","empty","append","init","root","document","ready"],"mappings":"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"}