{"version":3,"file":"blockmanager.min.js","sources":["../src/blockmanager.js"],"sourcesContent":["/* eslint-disable camelcase */\n/* eslint-disable no-unused-vars */\n/* eslint-disable require-jsdoc */\n/* eslint-disable valid-jsdoc */\n/* eslint-disable */\n\ndefine(['local_edwiserpagebuilder/jquery', 'core/ajax', 'core/templates'], function($, Ajax, Templates) {\n    var refaddBlockModalUrl = '';\n    const load = () => {\n        $(document).ready(function() {\n            let addblockbutton = \"#epbaddblockbutton\";\n            let epbcustommodal = \".epb_custom_modal.modal\";\n            let epbclosebutton = epbcustommodal + \" .modal-content .close\";\n            let epbcancelbutton = epbcustommodal + \" .modal-content .cancel\";\n            let epbblockupdatebutton = epbcustommodal + \" .modal-content .blocks-list .card-footer .update-content\";\n            let epblayoutupdatebutton = epbcustommodal + \" .modal-content .layout-list .card-footer .update-content\";\n\n            let showLayoutsbutton = epbcustommodal + \" .modal-content .show-layouts\";\n            let showBlocksbutton = epbcustommodal + \" .modal-content .show-blocks\";\n            let layoutContainer = epbcustommodal + \" .modal-body .addblock-modal-body.layout-list\";\n            let blockContainer = epbcustommodal + \" .modal-body .addblock-modal-body.blocks-list\";\n\n            let epbupdateblocklistbtn = epbcustommodal + \" .modal-content .action-buttons-modal .updateblocklist\";\n            let epbupdatelayoutlistbtn = epbcustommodal + \" .modal-content .action-buttons-modal .updatelayoutlist\";\n\n            let epbdeleteblockbtn = blockContainer + \" .card .delete-content\";\n            let epbdeletecardbtn = layoutContainer + \" .card .delete-content\";\n\n            let epblayoutcard = layoutContainer + \" .islayout\";\n\n            let updateinfoalert = '.updateinfoalert';\n            let updateinfoalertext ='.updateinfoalert .updateinfotext';\n            let edwiseradvancedblocktab ='.edwiseradvancedblocktab';\n            let moodleblockstab = '.moodleblockstab';\n\n            $(addblockbutton).on('click', function() {\n                $(epbcustommodal).removeClass('d-none');\n            });\n\n            $(document).on(\"click\", showLayoutsbutton, function() {\n                $(\"#epb_custom_modal .modal-content\").removeClass(\"blocklist\").addClass(\"layoutlist\");\n            });\n            $(document).on(\"click\", showBlocksbutton, function() {\n                $(\"#epb_custom_modal .modal-content\").removeClass(\"layoutlist\").addClass(\"blocklist\");\n            });\n\n            $(document).on(\"click\", epblayoutcard + \" a\", function(e) {\n                e.preventDefault();\n            });\n\n            $(document).on(\"click\", addblockbutton, function() {\n                $(epbcustommodal).removeClass('d-none');\n            });\n\n            $(epbclosebutton + \",\" + epbcancelbutton).on('click', function() {\n                $(epbcustommodal).addClass('d-none');\n            });\n            $(document).on(\"click\", epbblockupdatebutton, function() {\n                updateBlockContent(this, false);\n            });\n            $(document).on(\"click\", epblayoutupdatebutton, function() {\n                updateBlockContent(this, true);\n            });\n\n            function updateBlockContent(ele, islayout) {\n                $(ele).attr('disabled', true);\n                $(ele).find('.edw-icon').addClass(\" rotate\");\n\n                Ajax.call([{\n                    methodname: 'edwiserpagebuilder_update_block_content',\n                    args: {blockname: $(ele).attr(\"data-blockname\"), islayout: islayout},\n                    done: function(data) {\n                        $(ele).find('.edw-icon').removeClass(\"rotate\");\n                        if (data.status == false) {\n                            updateButton(ele);\n                        } else {\n                            $(ele).attr('disabled', false);\n                        }\n                    },\n                    fail: function() {\n                        $(ele).find('.edw-icon').removeClass(\"rotate\");\n                        $(ele).attr('disabled', false);\n                    }\n                }]);\n            }\n\n            function checkactivetab(){\n                console.log($(edwiseradvancedblocktab).hasClass('active'));\n                return $(edwiseradvancedblocktab).hasClass('active');\n            }\n\n            $(document).on(\"click\", epbupdateblocklistbtn, function() {\n                let _this = this;\n\n                $(_this).attr('disabled', true);\n                $(_this).find('.fa').removeClass('fa-download').addClass(\"fa-refresh rotate\");\n\n                var edwpageurl = $(_this).next().val();\n\n                Ajax.call([{\n                    methodname: 'edwiserpagebuilder_fetch_blocks_list',\n                    args: {\n                        edwpageurl: refaddBlockModalUrl,\n                        contextid: M.cfg.contextid\n                    },\n                    done: function(data) {\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        if (data.status == true) {\n                            $(blockContainer + ' [data-parentblock=\"edwiseradvancedblock\"]').remove();\n                            $(blockContainer + ' .block-cards').prepend(data.html);\n                            // updateButton(_this);\n                            $(_this).removeClass('btn-primary').addClass('btn-success d-none');\n                            $(updateinfoalert).removeClass('d-none');\n                            setTimeout(function(){\n                                $(updateinfoalert).addClass('d-none');\n                            },1500);\n                            if(!checkactivetab()){\n                                $('.advanceblockblocks').addClass('d-none');\n                            }\n                        } else {\n                            $(_this).attr('disabled', false);\n                            $(updateinfoalertext).text(\"Something Went Wrong\");\n                            $(updateinfoalert).removeClass('d-none');\n                        }\n                    },\n                    fail: function() {\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        $(_this).attr('disabled', false);\n                    }\n                }]);\n            });\n\n            $(document).on(\"click\", epbupdatelayoutlistbtn, function() {\n                let _this = this;\n\n                $(_this).attr('disabled', true);\n                $(_this).find('.fa').removeClass('fa-download').addClass(\"fa-refresh rotate\");\n\n                Ajax.call([{\n                    methodname: 'edwiserpagebuilder_fetch_layout_list',\n                    args: {},\n                    done: function(data) {\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        if (data.status == true) {\n                             $(layoutContainer + ' .block-cards').empty().prepend(data.html);\n                            updateButton(_this);\n                        } else {\n                            $(_this).attr('disabled', false);\n                        }\n                    },\n                    fail: function() {\n                        $(_this).find('.fa').removeClass(\"rotate\");\n                        $(_this).attr('disabled', false);\n                    }\n                }]);\n            });\n\n            $(document).on(\"click\", epbdeleteblockbtn, function() {\n                var id = $(this).data(\"blockid\");\n                delete_content(id, false); // False for block\n            });\n\n            $(document).on(\"click\", epbdeletecardbtn, function() {\n                var id = $(this).data(\"blockid\");\n                delete_content(id, true); // True for layout\n            });\n\n            /**\n             * @param id\n             * @param islayout\n             */\n            function delete_content(id, islayout) {\n                Ajax.call([{\n                    methodname: 'local_edwiserpagebuilder_delete_block',\n                    args: {id: id, islayout: islayout},\n                    done: function(data) {\n                        if (islayout) {\n                            var element = layoutContainer;\n                        } else {\n                            var element = blockContainer;\n                        }\n                        $(element).find('.data[data-blockid=\"' + id + '\"]').remove();\n                    },\n                    fail: function(data) {\n                        console.log(\"We are failure\");\n                        console.log(data);\n                    }\n                }]);\n            }\n\n            /**\n             * @param button\n             */\n            function updateButton(button) {\n                // $(button).removeClass('btn-primary').addClass('btn-success');\n                $(button).find('.fa').removeClass('fa-refresh').addClass('fa-check');\n                // jQuery(button).find('span').html(\"Updated\");\n            }\n\n        });\n    };\n\n\n    return {\n        // Init: initialize,\n        load: function(addBlockModalUrl){\n            refaddBlockModalUrl = addBlockModalUrl;\n            load();\n        }\n    };\n});\n"],"names":["define","$","Ajax","Templates","refaddBlockModalUrl","load","document","ready","epbcustommodal","layoutContainer","blockContainer","updateBlockContent","ele","islayout","attr","find","addClass","call","methodname","args","blockname","done","data","removeClass","status","updateButton","fail","delete_content","id","element","remove","console","log","button","on","epblayoutcard","e","preventDefault","epbclosebutton","this","_this","next","val","edwpageurl","contextid","M","cfg","prepend","html","setTimeout","hasClass","text","empty","addBlockModalUrl"],"mappings":"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"}